{% extends "checkins/base.html" %}
{% block content %}

<h1>Stats</h1>
<p>As of {{ today }}</p>

<div style="display:flex; gap:16px; flex-wrap:wrap; margin: 16px 0;">
  <div style="padding:12px 16px; border:1px solid #eee; border-radius:10px; min-width:180px;">
    <div>Total workouts</div>
    <div style="font-size:32px; font-weight:700;">{{ total_workouts }}</div>
  </div>

  <div style="padding:12px 16px; border:1px solid #eee; border-radius:10px; min-width:180px;">
    <div>Workouts (7d)</div>
    <div style="font-size:32px; font-weight:700;">{{ workouts_7 }}</div>
  </div>

  <div style="padding:12px 16px; border:1px solid #eee; border-radius:10px; min-width:180px;">
    <div>Workouts (30d)</div>
    <div style="font-size:32px; font-weight:700;">{{ workouts_30 }}</div>
  </div>
</div>

{% if recent_wins %}
  <h2>Recent wins (last 7 days)</h2>
  <ul>
    {% for w in recent_wins %}
      <li>
        <strong>{{ w.exercise }}</strong> — {{ w.change }}
        ({{ w.prev_weight }}×{{ w.prev_reps }} → {{ w.last_weight }}×{{ w.last_reps }})
      </li>
    {% endfor %}
  </ul>
{% endif %}

<h2>Progressive overload (Last vs Previous)</h2>

{% if progress_data %}
  <div style="display:flex; flex-direction:column; gap:12px;">
    {% for item in progress_data %}
      <div style="border:1px solid #eee; border-radius:12px; padding:14px;">
        <div style="display:flex; justify-content:space-between; align-items:center; gap:12px;">
          <h3 style="margin:0;">{{ item.exercise }}</h3>

          {% if item.improvement == "up" %}
            <span style="font-weight:700; color: #16a34a;">{{ item.change }} ↑</span>
          {% elif item.improvement == "down" %}
            <span style="font-weight:700; color: #dc2626;">{{ item.change }} ↓</span>
          {% else %}
            <span style="font-weight:700;">Same</span>
          {% endif %}
        </div>

        <div style="margin-top:8px;">
          <div><strong>Last ({{ item.last_date }}):</strong> {{ item.last_weight }} × {{ item.last_reps }}</div>
          <div><strong>Previous ({{ item.prev_date }}):</strong> {{ item.prev_weight }} × {{ item.prev_reps }}</div>
          <div style="margin-top:6px;"><strong>Best ever:</strong> {{ item.pr_weight }} × {{ item.pr_reps }}</div>
        </div>
      </div>
    {% endfor %}
  </div>
{% else %}
  <p>No enough data yet (need at least 2 workouts per exercise with weight entered).</p>
{% endif %}

{% endblock %}
